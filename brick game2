<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>SHE IsuueLetter ë²½ëŒê¹¨ê¸°</title>
<style>
    body { text-align:center; font-family:'ë§‘ì€ ê³ ë”•', Arial; }
    canvas { background:#f7f7f7; display:block; margin:0 auto; }
    #startBtn, #retryBtn {
        padding:10px 0;
        margin:4px 6px;
        cursor:pointer;
        font-size:16px;
        width:140px;
    }
</style>
</head>

<body>
<h2 style="font-size:28px; margin-bottom:6px;">ğŸ§± SHE IsuueLetter ë²½ëŒê¹¨ê¸°</h2>

<!-- ì ìˆ˜ ì•ˆë‚´ ë¬¸êµ¬ -->
<p style="font-size:18px; margin-top:0; margin-bottom:8px;">
    <strong style="padding:6px 14px; border-radius:18px; background:#ffe9b3; border:2px solid #e0a800; color:#865100; font-size:19px;">
        ğŸ¯ <span style="font-weight:900; color:#d35400;">10~12ì›” SHE ì£¼ì œ ë²½ëŒ: 10ì </span>
        / ê¸°íƒ€ ì•ˆì „Â·ë³´ê±´ ë‹¨ì–´: <span style="font-weight:700;">2ì </span>
    </strong>
</p>

<!-- 10ì  í™©ê¸ˆë²½ëŒ ì•ˆë‚´ ë¬¸êµ¬ -->
<p style="font-size:17px; margin:0 0 10px 0;">
    <strong style="color:#b4690e; font-weight:700;">
        â­ 10ì  í™©ê¸ˆë²½ëŒì„ ë…¸ë ¤ë³´ì„¸ìš”!
    </strong>
</p>

<button id="startBtn">START</button>
<button id="retryBtn" style="display:none;">ë‹¤ì‹œí•˜ê¸°</button>

<br/>
<!-- ìº”ë²„ìŠ¤ í¬ê¸° -->
<canvas id="gameCanvas" width="1055" height="620"></canvas>

<script>
// =======================
// ê¸°ë³¸ ì„¤ì •
// =======================
var canvas = document.getElementById("gameCanvas");
var ctx = canvas.getContext("2d");

var ballRadius = 8;
var x = canvas.width/2;
var y = canvas.height-40;

// ê³µ ì†ë„(ì¡°ê¸ˆ ëŠë¦¬ê²Œ)
var speed = 3.7;
var dx = speed * Math.cos(Math.PI/3);
var dy = -speed * Math.sin(Math.PI/3);

var paddleWidth = 120;
var paddleHeight = 10;
var paddleX = (canvas.width - paddleWidth) / 2;

var paddleSpeed = 8;

var rightPressed = false;
var leftPressed = false;

var gameRunning = false;
var gameEnded = false;
var showGuide = true;

// ğŸ”¹ ê¸°íšŒ 15ë²ˆ (í‘œì‹œ 15 â†’ 0, ë‚´ë¶€ëŠ” 14ê¹Œì§€ í—ˆìš©)
var totalChancesDisplay = 15;   // í™”ë©´ í‘œì‹œìš©
var maxChances = 14;            // usedChances > 14 ì´ë©´ ì¢…ë£Œ
var usedChances = 0;

var score = 0;
var hasHitBrick = false;

var arrowText = "";
var arrowTimer = 0;
var arrowX = 0;
var arrowY = 0;
var lastHitZone = null;

var showGameOver = false;
var finalScore = 0;

// ========================
// ê³ ì • ì‹œë“œ ëœë¤ (í•­ìƒ ë™ì¼ ë°°ì¹˜)
// ========================
var seed = 123456789;
function rand() {
    seed = (seed * 1664525 + 1013904223) >>> 0;
    return seed / 4294967296;
}

// ========================
// 10ì  ë‹¨ì–´ (10~12ì›” SHE ì£¼ì œ + ì¶”ê°€)
// ========================
var highWords = [
    "ì»¬ëŸ¬ì•ˆì „",
    "ë…¸ë™ì•ˆì „ ì¢…í•©ëŒ€ì±…",
    "í•œí™”63ì‹œí‹° ì•ˆì „ë³´ê±´ì‹œìŠ¤í…œ",
    "ì‚¬ë‹¤ë¦¬Nì•ˆì „ëª¨",
    "ë‡Œì¡¸ì¦",
    "ì•¼ì™¸ ì§ˆì‹ì‚¬ê³ ",
    "í•œë­ì§ˆí™˜",
    "ì„±íƒ„ì ˆ í™”ì¬",
    "TBM ì‹¤ì‹œ"          // ğŸ”¹ ìƒˆë¡œ ì¶”ê°€ëœ í™©ê¸ˆë²½ëŒ
];

// ========================
// ê¸°íƒ€ ì•ˆì „ë³´ê±´ ë‹¨ì–´ (2ì )
// ğŸ”¹ "TBM êµìœ¡" ì œê±°, "ìˆ˜ì§ì‚¬ë‹¤ë¦¬" ì—†ìŒ
// ========================
var pool = [
    "ì „ì—´ê¸°êµ¬ ì ê²€","ê°ì „ì‚¬ê³  ì˜ˆë°©","ì¶”ë½ì¬í•´ ì˜ˆë°©","ë°€íê³µê°„ ì‘ì—…",
    "í˜¸í¡ë³´í˜¸êµ¬","ì‚°ì†Œë†ë„ ì¸¡ì •","ì¤‘ëŒ€ì‚°ì—…ì¬í•´","ê·¼ê³¨ê²©ê³„ì§ˆí™˜",
    "PPE ì°©ìš©","ì†Œë°©ì•ˆì „ê´€ë¦¬","ìœ„í—˜ì„±í‰ê°€",
    "ì‘ì—…í—ˆê°€ì„œ","ì‘ê¸‰ì²˜ì¹˜","í™˜ê¸°ì„¤ë¹„ ê°€ë™","ì •ê¸°ì•ˆì „êµìœ¡",
    "ê·¼ê³¨ê²©ê³„ ë¶€ë‹´ì‘ì—…","í™”í•™ë¬¼ì§ˆ ì·¨ê¸‰","í­ë°œìœ„í—˜ ì¥ì†Œ","ë³´í˜¸ì¥ê°‘ ì°©ìš©",
    "ì•ˆì „ë‚œê°„ ì„¤ì¹˜","ë¹„ê³„ ì ê²€","ê°œêµ¬ë¶€ ì¶”ë½ë°©ì§€","ì‚°ì—…ì¬í•´ í†µê³„"
];

// ========================
// ë²½ëŒ ì„¤ì •
// ========================
var rows = 5;
var cols = 10;
var brickW = 95, brickH = 34;
var brickPad = 10;
var brickOffsetTop = 30;    // ë²½ëŒ ì‹œì‘ Y (ì¡°ê¸ˆ ìœ„)
var brickOffsetLeft = 15;

var bricks = [];
var LABEL_COUNT = 30;
var labels = [];
var i;

// highWords ë¨¼ì € ì±„ìš°ê¸°
for (i = 0; i < highWords.length; i++) {
    labels.push(highWords[i]);
}
// ë‚˜ë¨¸ì§€ LABEL_COUNTê¹Œì§€ poolì—ì„œ ì±„ìš°ê¸°
for (i = 0; i < pool.length && labels.length < LABEL_COUNT; i++) {
    labels.push(pool[i]);
}

// ìœ„ì¹˜ êµí™˜ ë„ìš°ë¯¸ (í•„ìš” ì‹œ ì‚¬ìš©)
function swapLabel(a, b) {
    var idxA = -1;
    var idxB = -1;
    for (var k = 0; k < labels.length; k++) {
        if (labels[k] === a) idxA = k;
        if (labels[k] === b) idxB = k;
    }
    if (idxA !== -1 && idxB !== -1) {
        var tmp = labels[idxA];
        labels[idxA] = labels[idxB];
        labels[idxB] = tmp;
    }
}

// ì˜ˆì „ ë¶„ì‚°ìš© ìŠ¤ì™‘ ì¼ë¶€ ìœ ì§€ (ìˆ˜ì§ì‚¬ë‹¤ë¦¬ëŠ” ì œê±°ë¨)
swapLabel("ì»¬ëŸ¬ì•ˆì „", "ì•ˆì „ë‚œê°„ ì„¤ì¹˜");
swapLabel("ì‚¬ë‹¤ë¦¬Nì•ˆì „ëª¨", "ì‚°ì—…ì¬í•´ í†µê³„");
swapLabel("ë‡Œì¡¸ì¦", "í™˜ê¸°ì„¤ë¹„ ê°€ë™");
swapLabel("ë…¸ë™ì•ˆì „ ì¢…í•©ëŒ€ì±…", "ì‚°ì—…ì¬í•´ í†µê³„");

// í…ìŠ¤íŠ¸ ë²½ëŒ + ë¹ˆ ë²½ëŒ ë°ì´í„° ë§Œë“¤ê¸°
var totalBricks = rows * cols;  // 50
var brickData = [];

// í…ìŠ¤íŠ¸ ë²½ëŒ 30ê°œ
for (i = 0; i < LABEL_COUNT; i++) {
    var w = labels[i];
    var isHigh = (highWords.indexOf(w) !== -1);
    brickData.push({
        label: w,
        score: isHigh ? 10 : 2,
        isHigh: isHigh
    });
}
// ë¹ˆ ë²½ëŒ 20ê°œ
while (brickData.length < totalBricks) {
    brickData.push({
        label: "",
        score: 0,
        isHigh: false
    });
}

// ì‹œë“œ ê³ ì • ì…”í”Œ (í•­ìƒ ë™ì¼)
function shuffle(array){
    for (var j = array.length - 1; j > 0; j--){
        var r = Math.floor(rand() * (j + 1));
        var temp = array[j];
        array[j] = array[r];
        array[r] = temp;
    }
}
shuffle(brickData);

// bricks 2ì°¨ì› ë°°ì—´í™”
var idxData = 0;
for (var c = 0; c < cols; c++){
    bricks[c] = [];
    for (var r = 0; r < rows; r++){
        var bd = brickData[idxData++];
        bricks[c][r] = {
            x:0, y:0,
            status:1,
            label: bd.label,
            score: bd.score,
            isHigh: bd.isHigh
        };
    }
}

// ========================
// íŠ¹ì • ë‹¨ì–´ë¥¼ ì˜¤ë¥¸ìª½ì— ë°°ì¹˜ (ì„±íƒ„ì ˆ í™”ì¬, ë…¸ë™ì•ˆì „ ì¢…í•©ëŒ€ì±…, TBM ì‹¤ì‹œ)
// ========================
function swapBrickContent(c1, r1, c2, r2) {
    var b1 = bricks[c1][r1];
    var b2 = bricks[c2][r2];

    var tmpLabel = b1.label;
    var tmpScore = b1.score;
    var tmpHigh  = b1.isHigh;

    b1.label = b2.label;
    b1.score = b2.score;
    b1.isHigh = b2.isHigh;

    b2.label = tmpLabel;
    b2.score = tmpScore;
    b2.isHigh = tmpHigh;
}

function moveBrickLabelTo(targetLabel, destC, destR) {
    var found = null;
    for (var c = 0; c < cols; c++) {
        for (var r = 0; r < rows; r++) {
            if (bricks[c][r].label === targetLabel) {
                found = {c:c, r:r};
                break;
            }
        }
        if (found) break;
    }
    if (!found) return;
    if (found.c === destC && found.r === destR) return;

    swapBrickContent(found.c, found.r, destC, destR);
}

// ì˜¤ë¥¸ìª½ ë ì—´(9ë²ˆ ì¸ë±ìŠ¤)ì— ì„¸ ë‹¨ì–´ ë°°ì¹˜
moveBrickLabelTo("ì„±íƒ„ì ˆ í™”ì¬",      7, 0);
moveBrickLabelTo("ë…¸ë™ì•ˆì „ ì¢…í•©ëŒ€ì±…", 8, 2);
moveBrickLabelTo("TBM ì‹¤ì‹œ",         9, 1);

// ========================
// ë²„íŠ¼ ì œì–´
// ========================
var startBtn = document.getElementById("startBtn");
var retryBtn = document.getElementById("retryBtn");

startBtn.onclick = function(){
    if (gameEnded) {
        location.reload();
        return;
    }
    gameRunning = true;
    showGuide = false;
};

retryBtn.onclick = function(){
    location.reload();
};

// ========================
// í‚¤ ì´ë²¤íŠ¸
// ========================
document.addEventListener("keydown", function(e){
    if (e.keyCode === 39) rightPressed = true;
    else if (e.keyCode === 37) leftPressed = true;
});
document.addEventListener("keyup", function(e){
    if (e.keyCode === 39) rightPressed = false;
    else if (e.keyCode === 37) leftPressed = false;
});

// ========================
// 2ì¤„ë¡œ í‘œê¸°í•  ë‹¨ì–´ ë§¤í•‘
// ========================
var multiLineMap = {
    "í•œí™”63ì‹œí‹° ì•ˆì „ë³´ê±´ì‹œìŠ¤í…œ": ["í•œí™”63ì‹œí‹°", "ì•ˆì „ë³´ê±´ì‹œìŠ¤í…œ"],
    "ë…¸ë™ì•ˆì „ ì¢…í•©ëŒ€ì±…": ["ë…¸ë™ì•ˆì „", "ì¢…í•©ëŒ€ì±…"],
    "ê·¼ê³¨ê²©ê³„ ë¶€ë‹´ì‘ì—…": ["ê·¼ê³¨ê²©ê³„", "ë¶€ë‹´ì‘ì—…"]
};

function drawLabel(text, x, y, width){
    if (!text) return;

    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    if (multiLineMap[text]) {
        var lines = multiLineMap[text];
        ctx.font = "bold 15px 'ë§‘ì€ ê³ ë”•'";
        ctx.lineWidth = 3;
        ctx.strokeStyle = "rgba(0,0,0,0.85)";
        ctx.fillStyle = "#ffffff";

        ctx.strokeText(lines[0], x, y - 8);
        ctx.fillText(lines[0], x, y - 8);

        ctx.strokeText(lines[1], x, y + 8);
        ctx.fillText(lines[1], x, y + 8);
    } else {
        drawFitText(text, x, y, width);
    }
}

function drawFitText(txt, x, y, maxWidth){
    var size = 17;
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(0,0,0,0.85)";
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold " + size + "px 'ë§‘ì€ ê³ ë”•'";

    while (ctx.measureText(txt).width > maxWidth && size > 11){
        size--;
        ctx.font = "bold " + size + "px 'ë§‘ì€ ê³ ë”•'";
    }
    ctx.strokeText(txt, x, y);
    ctx.fillText(txt, x, y);
}

// ========================
// ë²½ëŒ ëª¨ì–‘ (í™©ê¸ˆ/ì¼ë°˜)
// ========================
function drawBrickShape(bx, by, bw, bh, isHigh){
    if (isHigh) {
        var g = ctx.createLinearGradient(bx, by, bx, by + bh);
        g.addColorStop(0, "#ffe58f");
        g.addColorStop(0.5, "#ffc107");
        g.addColorStop(1, "#ff9800");
        ctx.fillStyle = g;
        ctx.fillRect(bx, by, bw, bh);

        ctx.strokeStyle = "#b26a00";
        ctx.lineWidth = 2;
        ctx.strokeRect(bx + 0.5, by + 0.5, bw - 1, bh - 1);

        ctx.strokeStyle = "rgba(255,255,255,0.8)";
        ctx.beginPath();
        ctx.moveTo(bx + 2, by + 2);
        ctx.lineTo(bx + bw - 2, by + 2);
        ctx.stroke();

    } else {
        var grad = ctx.createLinearGradient(bx, by, bx, by + bh);
        grad.addColorStop(0, "#d35400");
        grad.addColorStop(0.5, "#b03a2e");
        grad.addColorStop(1, "#7b241c");
        ctx.fillStyle = grad;
        ctx.fillRect(bx, by, bw, bh);

        ctx.strokeStyle = "#5b1a12";
        ctx.lineWidth = 2;
        ctx.strokeRect(bx + 0.5, by + 0.5, bw - 1, bh - 1);
    }
}

// ========================
// íŒ¨ë“¤ í™”ì‚´í‘œ
// ========================
function updateArrowAtPaddle(hitPos, hitX){
    if (!hasHitBrick) return;

    if (hitPos < 1/3) {
        arrowText = "â†–";
        lastHitZone = "left";
    } else if (hitPos > 2/3) {
        arrowText = "â†—";
        lastHitZone = "right";
    } else {
        arrowText = "â†‘";
        lastHitZone = "center";
    }

    arrowX = hitX;
    var paddleY = canvas.height - paddleHeight - 10;
    arrowY = paddleY - 22;

    arrowTimer = 20;
}

// ========================
// ë²½ëŒ ì¶©ëŒ
// ========================
function collisionBricks(){
    if (!gameRunning) return;

    for (var c=0; c<cols; c++){
        for (var r=0; r<rows; r++){
            var b = bricks[c][r];
            if (b.status === 1){
                if (x > b.x && x < b.x + brickW &&
                    y > b.y && y < b.y + brickH){

                    dy = -dy;
                    b.status = 0;

                    if (b.score > 0) {
                        score += b.score;
                    }
                    hasHitBrick = true;
                }
            }
        }
    }
}

// ========================
// ê²Œì„ ì¢…ë£Œ
// ========================
function endGame(){
    if (gameEnded) return;
    gameEnded = true;
    gameRunning = false;
    finalScore = score;
    showGameOver = true;
    retryBtn.style.display = "inline-block";
}

// ========================
// ë©”ì¸ ë Œë”ë§
// ========================
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ìƒë‹¨ íšŒìƒ‰ ë°”
    ctx.fillStyle = "#dddddd";
    ctx.fillRect(0, 0, canvas.width, brickOffsetTop - 10);

    // ë²½ëŒ
    for (var c=0; c<cols; c++){
        for (var r=0; r<rows; r++){
            var b = bricks[c][r];
            if (b.status === 1){
                var bx = c*(brickW+brickPad) + brickOffsetLeft;
                var by = r*(brickH+brickPad) + brickOffsetTop;
                b.x = bx;
                b.y = by;

                drawBrickShape(bx, by, brickW, brickH, b.isHigh);
                drawLabel(b.label, bx + brickW/2, by + brickH/2, brickW - 10);
            }
        }
    }

    // ê³µ
    ctx.beginPath();
    ctx.arc(x,y,ballRadius,0,Math.PI*2);
    ctx.fillStyle="#ffcc00";
    ctx.fill();
    ctx.closePath();

    // íŒ¨ë“¤ 3ë“±ë¶„
    var paddleY = canvas.height - paddleHeight - 10;
    var segW = paddleWidth / 3;

    for (var iSeg = 0; iSeg < 3; iSeg++) {
        var segX = paddleX + iSeg * segW;
        var baseColor = "#333";

        if (lastHitZone === "left" && iSeg === 0) baseColor = "#555";
        if (lastHitZone === "center" && iSeg === 1) baseColor = "#555";
        if (lastHitZone === "right" && iSeg === 2) baseColor = "#555";

        ctx.fillStyle = baseColor;
        ctx.fillRect(segX, paddleY, segW, paddleHeight);
    }

    ctx.strokeStyle = "#888";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(paddleX + segW, paddleY);
    ctx.lineTo(paddleX + segW, paddleY + paddleHeight);
    ctx.moveTo(paddleX + 2*segW, paddleY);
    ctx.lineTo(paddleX + 2*segW, paddleY + paddleHeight);
    ctx.stroke();

    // ì ìˆ˜ & ë‚¨ì€íšŸìˆ˜
    ctx.fillStyle="#000";
    ctx.font="18px ë§‘ì€ ê³ ë”•";
    ctx.textAlign="left";
    ctx.fillText("ì ìˆ˜: "+score+"ì ",10,16);

    ctx.textAlign="right";
    var remain = totalChancesDisplay - usedChances;
    if (remain < 0) remain = 0;
    ctx.fillText("ë‚¨ì€ íšŸìˆ˜: " + remain, canvas.width-10, 16);

    // íŒ¨ë“¤ ìœ„ í™”ì‚´í‘œ
    if (arrowTimer > 0 && hasHitBrick && !showGameOver){
        ctx.font = "30px Arial";
        ctx.fillStyle = "red";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(arrowText, arrowX, arrowY);
        arrowTimer--;
    }

    collisionBricks();

    // ì‹œì‘ ì•ˆë‚´ ë°•ìŠ¤
    if (showGuide && !showGameOver){
        var boxW = 520;
        var boxH = 90;
        var boxX = (canvas.width - boxW)/2;
        var boxY = canvas.height/2 - boxH/2;

        ctx.fillStyle = "rgba(255,255,255,0.95)";
        ctx.strokeStyle = "#cccccc";
        ctx.lineWidth = 1.5;
        ctx.fillRect(boxX, boxY, boxW, boxH);
        ctx.strokeRect(boxX, boxY, boxW, boxH);

        ctx.fillStyle = "#444";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.font = "22px 'ë§‘ì€ ê³ ë”•'";
        ctx.fillText("STARTë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”", canvas.width/2, boxY + 30);
        ctx.font = "18px 'ë§‘ì€ ê³ ë”•'";
        ctx.fillText("í‚¤ë³´ë“œì˜ í™”ì‚´í‘œë¡œ íŒ¨ë“¤ì„ ì›€ì§ì—¬ì£¼ì„¸ìš”", canvas.width/2, boxY + 60);
    }

    // ê²Œì„ì˜¤ë²„ í™”ë©´
    if (showGameOver){
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.fillRect(0,0,canvas.width,canvas.height);

        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.font = "30px 'ë§‘ì€ ê³ ë”•'";
        ctx.fillText("ìµœì¢… ì ìˆ˜: " + finalScore + "ì ", canvas.width/2, canvas.height/2 - 10);

        ctx.font = "18px 'ë§‘ì€ ê³ ë”•'";
        ctx.fillText("ìœ„ì— 'ë‹¤ì‹œí•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.", canvas.width/2, canvas.height/2 + 25);
    }

    if (gameRunning && !gameEnded){

        x += dx;
        y += dy;

        // ì¢Œìš° ë²½
        if (x + dx > canvas.width-ballRadius || x + dx < ballRadius){
            dx = -dx;
        }

        // ìœ„ìª½ ë²½
        if (y + dy < ballRadius){
            dy = -dy;
        }

        // ë°”ë‹¥(íŒ¨ë“¤ ì˜ì—­)
        if (y + dy > canvas.height - ballRadius - 10){
            if (x > paddleX && x < paddleX + paddleWidth){
                var hitPos = (x - paddleX) / paddleWidth;
                if (hitPos < 0) hitPos = 0;
                if (hitPos > 1) hitPos = 1;

                var maxAngle = 5 * Math.PI / 6;
                var minAngle = Math.PI / 6;
                var angle = maxAngle - (maxAngle - minAngle) * hitPos;

                dx = speed * Math.cos(angle);
                dy = -speed * Math.sin(angle);

                updateArrowAtPaddle(hitPos, x);

                usedChances++;
                if (usedChances > maxChances){
                    endGame();
                }

            } else {
                endGame();
            }
        }

        // íŒ¨ë“¤ ì´ë™
        if (rightPressed) paddleX += paddleSpeed;
        if (leftPressed) paddleX -= paddleSpeed;
        if (paddleX < 0) paddleX = 0;
        if (paddleX > canvas.width - paddleWidth) paddleX = canvas.width - paddleWidth;
    }

    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
